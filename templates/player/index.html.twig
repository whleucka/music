<div class="bg-light d-flex p-2">
    <span id="cover" class="d-flex align-items-center">
        <img src="{{ player.cover }}" alt="cover" />
        <div class="info d-none d-sm-block d-flex flex-column ps-2">
            <div class="truncate" title="{{ player.title|raw }}"><strong>{{ player.title|raw }}</strong></div>
            <div class="truncate text-muted" title="{{ player.artist|raw }}"><small>{{ player.artist|raw }}</small></div>
        </div>
    </span>
    <span id="controls" class="d-flex align-items-center justify-content-center w-100">
        <button class="btn" id="previous-track">Previous</button>
        <button class="btn" id="rewind">Rewind</button>
        <button class="btn" id="play" onClick="playPause()">Play</button>
        <button class="btn" id="fast-forward">Forward</button>
        <button class="btn" id="next-track">Next</button>
    </span>
    <audio id="audio" src="{{ player.source }}" autoPlay />
</div>

<script>
var player = document.getElementById("audio");
var playButton = document.getElementById("play");

var playPause = async () => {
    if (player.paused) {
        await player.play();
    } else {
        await player.pause();
    }
}

var activeTrack = () => {
    const trackRows = document.querySelectorAll(".track-row");
    trackRows.forEach((row) => {
        row.classList.remove("active");
    });

    const currentTrack = document.getElementById('{{ player.id }}');
    if (currentTrack) currentTrack.classList.toggle("active");
}

player.onplaying  = () => {
    playButton.innerText = "Pause";
    console.log("playing...");
    activeTrack();
}

player.onpause = () => {
    playButton.innerText = "Play";
    console.log("paused...");
}
</script>
